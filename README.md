# Taro-city：山东省支付宝，爱山东
多端开发 taro3 + redux + taro-ui + Hook


## 心得
 Taro真的有很多很多坑，在构建上也遇到很多问题，这次搭建这个的前提原因是啥呢，可能闲的无聊才搭建的吧
## 功能
  登录模块，用户模块，搜索模块，主题服务模块，人脸识别模块等。封装接口，跳转方式，不同情况下未登录时跳转登录在跳转页面方式
### 原因
  公司之前做的爱山东支付包小程序太过垃圾，导致现在要重构，这个项目就轮到我了，但我这个人恰好没有了解过支付包小程序，只会写基本的用法，与其使用学习小程序，不如学习Taro（站在React一端的），现在微信，支付宝，百度，京东，字节等小程序层出不穷，故多端肯定是以后的趋势（至于为什么不用公司产品直接搭建，大家都懂~）

### Taro框架（问题） 
  1>redux-persist持久化在小程序内无法使用，只能使用存储
  
  2>Taro在新办中获取路由的方法getCurrentInstance()，无法在H5中获取传递的参数，小程序可以

### 构建问题
  1>组件问题：所谓组件就是可以服用，提高复用率，但当遇见较为复杂的组件封装时，要想复用，比如说列表，列表本身没有太多的难度，单给列表加上足够多的条件时，所需要的参数就变多了(如主标题，副标题，主标题后面显示的图案，是否跳转等)参数一多，那么固定的传的值也就必须固定了，这本身没有问题，但在大多数情况下列表的数据是接口返回的，里面的字段都不同，所展示的内容也就不同的字段，那么要是想用这个组件，必须要将接口返回的数据过滤出来，换成组件想用的参数作为替换，那么过滤这一步骤，感觉跟不用组件重新写个列表的过程差不多，那么还有必要使用组件吗？（这点，到底怎么样来创造出完美的组件问题）
  
  2>目前我认为将获取的token然后调取接口获得用户信息，然后存入缓存，当用户关闭程序，再次打开时就能拿到自己的信息，为什么不重新通过调接口呢？（反正想的拿到的信息都一样，也就没必要调用接口，影响加载速度）
  
    但是我想的有问题，原因是token，他并不是恒定的，是会有实效性，也就是说，我如果一直存在缓存里，这本身就是错误的，那么问题来了，我无法知道token是否是最新值，并不知道它存在多久才会刷新，那么我该如何知道他是最新的值呢？目前只能每次重新打开时小程序时调用登录接口，看是否能获取到信息，如果获取到，则证明token没有刷新，反之，清空所有缓存
    
    在这里要说下，在小程序与H5做交互时，H5需要获取用户信息，也就是token奥
    
      我有点多虑的点，那就是什么时候调取登录接口呢，只在首次加载的时候就调用吗？是不是在跟h5做交互的时候再次调取登录接口看是否是最新的token呢？这样不是很影响性能吗？  其实这点完全没有必要去考虑，原因很简单他是小程序，不是支付宝（App），百分之九十九都会用完直接关闭的，这点时间token是不可能刷信息，所以不需要考虑。（考虑过多~~~，那么剩下的百分之一呢，大家都懂）
      
    那么有人可能会说我在打开的一瞬间token是存在的，过了一两秒token失效了怎么办？那我觉得概率太低，说白了也无法去解决。

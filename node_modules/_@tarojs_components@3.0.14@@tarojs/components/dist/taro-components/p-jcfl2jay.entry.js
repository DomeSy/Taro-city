import{h as t,r as a,c as r,H as s,g as e}from"./p-afb5cad8.js";import{c as i}from"./p-cff38696.js";function o(t){return"/"===t.charAt(0)}function n(t,a){for(var r=a,s=r+1,e=t.length;s<e;r+=1,s+=1)t[r]=t[s];t.pop()}const h=t=>{let a,r=t||"";const s={path:null,query:null,fragment:null};return a=r.indexOf("#"),a>-1&&(s.fragment=r.substring(a+1),r=r.substring(0,a)),a=r.indexOf("?"),a>-1&&(s.query=r.substring(a+1),r=r.substring(0,a)),s.path=r,s},b=a=>{const{index:r=null,isSelected:s=!1,textColor:e={},iconPath:o="",badgeText:n=null,showRedDot:h=!1,text:b}=a,l=i("weui-tabbar__item",{"weui-bar__item_on":s});return t("a",{key:r,href:"javascript:;",class:l,onClick:function(){a.onSelect(a.index)}},t("span",{style:{display:"inline-block",position:"relative"}},t("img",{src:o,alt:"",class:"weui-tabbar__icon"}),n&&t("span",{class:"weui-badge taro-tabbar-badge",style:{position:"absolute",top:"-2px",right:"-13px"}},n),h&&t("span",{class:"weui-badge weui-badge_dot",style:{position:"absolute",top:"0",right:"-6px"}})),t("p",{class:"weui-tabbar__label",style:{color:e}},b))},l=require("@tarojs/taro"),d=t=>"/"===t[0]?t:`/${t}`,c=class{constructor(t){a(this,t),this.homePage="",this.customRoutes=[],this.tabbarPos="bottom",this.selectedIndex=-1,this.status=0,this.getOriginUrl=t=>{const a=this.customRoutes.filter(([,a])=>h(a).path===h(t).path);return a.length?a[0][0]:t},this.getSelectedIndex=t=>{let a=-1;return this.list.forEach(({pagePath:r},s)=>{h(t).path===h(r).path&&(a=s)}),a},this.switchTab=t=>{this.selectedIndex=t,l.navigateTo({url:this.list[t].pagePath})},this.switchTabHandler=({url:t,successHandler:a,errorHandler:r})=>{const s=function(t,a){void 0===a&&(a="");var r,s=t&&t.split("/")||[],e=a&&a.split("/")||[],i=t&&o(t),h=a&&o(a),b=i||h;if(t&&o(t)?e=s:s.length&&(e.pop(),e=e.concat(s)),!e.length)return"/";if(e.length){var l=e[e.length-1];r="."===l||".."===l||""===l}else r=!1;for(var d=0,c=e.length;c>=0;c--){var u=e[c];"."===u?n(e,c):".."===u?(n(e,c),d++):d&&(n(e,c),d--)}if(!b)for(;d--;d)e.unshift("..");!b||""===e[0]||e[0]&&o(e[0])||e.unshift("");var _=e.join("/");return r&&"/"!==_.substr(-1)&&(_+="/"),_}(t,this.getOriginUrl(this.getCurrentUrl()||this.homePage)),e=this.getSelectedIndex(s);e>-1?(this.switchTab(e),a({errMsg:"switchTab:ok"})):r({errMsg:`switchTab:fail page "${s}" is not found`})},this.routerChangeHandler=t=>{let a,r;if(t&&(a=t.toLocation),a&&a.path){const t=d(a.path);r="/"===t?this.homePage:t}else r=this.getCurrentUrl();this.selectedIndex=this.getSelectedIndex(this.getOriginUrl(r))},this.setTabBarBadgeHandler=({index:t,text:a,errorHandler:r})=>{t in this.list?(this.list[t].showRedDot=!1,this.list[t].badgeText=a):r({errMsg:"setTabBarBadge:fail tabbar item not found"})},this.removeTabBarBadgeHandler=({index:t,successHandler:a,errorHandler:r})=>{t in this.list?(this.list[t].badgeText=null,this.list[t].badgeText=null,a({errMsg:"removeTabBarBadge:ok"})):r({errMsg:"removeTabBarBadge:fail tabbar item not found"})},this.showTabBarRedDotHandler=({index:t,successHandler:a,errorHandler:r})=>{const s=this.list;t in s?(s[t].badgeText=null,s[t].showRedDot=!0,a({errMsg:"showTabBarRedDot:ok"})):r({errMsg:"showTabBarRedDot:fail tabbar item not found"})},this.hideTabBarRedDotHandler=({index:t,successHandler:a,errorHandler:r})=>{const s=this.list;t in s?(s[t].showRedDot=!1,a({errMsg:"hideTabBarRedDot:ok"})):r({errMsg:"hideTabBarRedDot:fail tabbar item not found"})},this.showTabBarHandler=({successHandler:t})=>{this.status=0,t({errMsg:"showTabBar:ok"})},this.hideTabBarHandler=({animation:t,successHandler:a})=>{this.status=t?2:1,a({errMsg:"hideTabBar:ok"})};const s=this.conf.list,e=this.conf.customRoutes;if("[object Array]"!==Object.prototype.toString.call(s)||s.length<2||s.length>5)throw new Error("tabBar 配置错误");this.homePage=d(this.conf.homePage);for(const a in e)this.customRoutes.push([a,e[a]]);s.forEach(t=>{0!==t.pagePath.indexOf("/")&&(t.pagePath="/"+t.pagePath)}),this.list=s,this.onLongPress=r(this,"longpress",7)}getCurrentUrl(){const t=this.conf.basename||"/";let a;if("hash"===this.conf.mode){const t=window.location.href,r=t.indexOf("#");a=-1===r?"":t.substring(r+1)}else a=location.pathname;const r=d(((t,a)=>new RegExp("^"+a+"(\\/|\\?|#|$)","i").test(t))(s=a,e=t)?s.substr(e.length):s);var s,e;return"/"===r?this.homePage:r}bindEvent(){l.eventCenter.on("__taroRouterChange",this.routerChangeHandler),l.eventCenter.on("__taroSwitchTab",this.switchTabHandler),l.eventCenter.on("__taroSetTabBarBadge",this.setTabBarBadgeHandler),l.eventCenter.on("__taroRemoveTabBarBadge",this.removeTabBarBadgeHandler),l.eventCenter.on("__taroShowTabBarRedDotHandler",this.showTabBarRedDotHandler),l.eventCenter.on("__taroHideTabBarRedDotHandler",this.hideTabBarRedDotHandler),l.eventCenter.on("__taroShowTabBar",this.showTabBarHandler),l.eventCenter.on("__taroHideTabBar",this.hideTabBarHandler)}removeEvent(){l.eventCenter.off("__taroRouterChange",this.routerChangeHandler),l.eventCenter.off("__taroSwitchTab",this.switchTabHandler),l.eventCenter.off("__taroSetTabBarBadge",this.setTabBarBadgeHandler),l.eventCenter.off("__taroRemoveTabBarBadge",this.removeTabBarBadgeHandler),l.eventCenter.off("__taroShowTabBarRedDotHandler",this.showTabBarRedDotHandler),l.eventCenter.off("__taroHideTabBarRedDotHandler",this.hideTabBarRedDotHandler),l.eventCenter.off("__taroShowTabBarHandler",this.showTabBarHandler),l.eventCenter.off("__taroHideTabBarHandler",this.hideTabBarHandler)}componentDidLoad(){this.tabbarPos=this.tabbar.nextElementSibling?"top":"bottom",this.bindEvent(),this.routerChangeHandler()}componentDidUnload(){this.removeEvent()}render(){const{conf:a,tabbarPos:r="bottom"}=this,e=this.status,o=i("weui-tabbar",{[`taro-tabbar__border-${a.borderStyle||"black"}`]:!0});return t(s,{class:i("taro-tabbar__tabbar",`taro-tabbar__tabbar-${r}`,{"taro-tabbar__tabbar-hide":-1===this.selectedIndex||1===e,"taro-tabbar__tabbar-slideout":2===e})},t("div",{class:o,style:{backgroundColor:a.backgroundColor||""}},this.list.map((r,s)=>{const e=this.selectedIndex===s;let i,o;return e?(i=a.selectedColor,o=r.selectedIconPath):(i=a.color||"",o=r.iconPath),t(b,{index:s,onSelect:this.switchTab.bind(this),isSelected:e,textColor:i,iconPath:o,text:r.text,badgeText:r.badgeText,showRedDot:r.showRedDot})})))}get tabbar(){return e(this)}static get style(){return"#app,body,html{height:100%}.taro-tabbar__border-white:before{border-top-color:#fff!important}.taro-tabbar__container{display:-ms-flexbox;display:flex;height:100%;-ms-flex-direction:column;flex-direction:column;overflow:hidden}.taro-tabbar__panel{-ms-flex:1;flex:1;position:relative;overflow:auto;-webkit-overflow-scrolling:touch}.taro-tabbar__tabbar{position:relative;height:50px;width:100%;-webkit-transition:bottom .2s,top .2s;transition:bottom .2s,top .2s}.taro-tabbar__tabbar-top{top:0}.taro-tabbar__tabbar-bottom{bottom:0}.taro-tabbar__tabbar-hide{display:none}.taro-tabbar__tabbar-slideout{top:-52px;-ms-flex:0 0;flex:0 0}.taro-tabbar__panel+.taro-tabbar__tabbar-slideout{top:auto;bottom:-52px}"}};export{c as taro_tabbar};
import{r as t,c as s,h as i,H as h,g as e}from"./p-afb5cad8.js";import{c as r}from"./p-cff38696.js";const a=require("@tarojs/taro");const o="undefined"!=typeof navigator&&/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),n={activate:"release",deactivate:"pull",release:"loading",finish:"finish"};let c=!1;try{const t=Object.defineProperty({},"passive",{get(){c=!0}});window.addEventListener("cancel",()=>({}),t)}catch(u){}const l=!!c&&{passive:!1},d=class{constructor(i){t(this,i),this.prefixCls="rmc-pull-to-refresh",this.distanceToRefresh=50,this.damping=100,this.indicator=n,this.currSt="deactivate",this.dragOnEdge=!1,this._ScreenY=0,this._startScreenY=0,this._lastScreenY=0,this._isMounted=!1,this.scrollContainer=document.querySelector(".taro-tabbar__panel")||document.body,this.triggerPullDownRefresh=t=>{!this.dragOnEdge&&this._isMounted&&(t?(this._lastScreenY=this.distanceToRefresh+1,this.currSt="release",this.setContentStyle(this._lastScreenY)):(this.currSt="finish",this.reset()))},this.init=()=>{const t=this.scrollContainer;this._to={touchstart:this.onTouchStart.bind(this,t),touchmove:this.onTouchMove.bind(this,t),touchend:this.onTouchEnd.bind(this,t),touchcancel:this.onTouchEnd.bind(this,t)},Object.keys(this._to).forEach(s=>{t.addEventListener(s,this._to[s],l)})},this.destroy=()=>{const t=this.scrollContainer;Object.keys(this._to).forEach(s=>{t.removeEventListener(s,this._to[s])})},this.onTouchStart=(t,s)=>{this._ScreenY=this._startScreenY=s.touches[0].screenY,this._lastScreenY=this._lastScreenY||0},this.isEdge=t=>{const s=this.scrollContainer;return s&&s===document.body?(document.scrollingElement?document.scrollingElement:document.body).scrollTop<=0:t.scrollTop<=0},this.damp=t=>Math.abs(this._lastScreenY)>this.damping?0:t*(.6*(1-Math.abs(this._ScreenY-this._startScreenY)/window.screen.height)),this.onTouchMove=(t,s)=>{const i=s.touches[0].screenY;if(!(this._startScreenY>i)&&this.isEdge(t)){this.dragOnEdge||(this._ScreenY=this._startScreenY=s.touches[0].screenY,this.dragOnEdge=!0),s.cancelable&&s.preventDefault();const t=Math.round(i-this._ScreenY);this._ScreenY=i,this._lastScreenY+=this.damp(t),this.setContentStyle(this._lastScreenY),Math.abs(this._lastScreenY)<this.distanceToRefresh?"deactivate"!==this.currSt&&(this.currSt="deactivate"):"deactivate"===this.currSt&&(this.currSt="activate"),o&&s.changedTouches[0].clientY<0&&this.onTouchEnd()}},this.onTouchEnd=()=>{this.dragOnEdge&&(this.dragOnEdge=!1),"activate"===this.currSt?(this.currSt="release",this.onRefresh.emit(this),this._lastScreenY=this.distanceToRefresh+1,this.setContentStyle(this._lastScreenY)):"release"===this.currSt?(this._lastScreenY=this.distanceToRefresh+1,this.setContentStyle(this._lastScreenY)):this.reset()},this.reset=()=>{this._lastScreenY=0,this.setContentStyle(0)},this.setContentStyle=t=>{var s,i;this.contentRef&&((s=this.contentRef.style).transform=i=t?`translate3d(0px,${t}px,0)`:"",s.webkitTransform=i,s.MozTransform=i)},this.onRefresh=s(this,"refresh",7)}statusChange(){if("release"===this.currSt){const t=this.el.closest(".taro_page");t&&t.__page&&t.__page.onPullDownRefresh()}}componentDidUnload(){this.destroy()}componentDidLoad(){this.init(),this._isMounted=!0,a.eventCenter.on("__taroStartPullDownRefresh",({successHandler:t,errorHandler:s})=>{try{this.triggerPullDownRefresh(!0),t({errMsg:"startPullDownRefresh: ok"})}catch(u){s({errMsg:"startPullDownRefresh: fail"})}}),a.eventCenter.on("__taroStopPullDownRefresh",({successHandler:t,errorHandler:s})=>{try{this.triggerPullDownRefresh(!1),t({errMsg:"stopPullDownRefresh: ok"})}catch(u){s({errMsg:"stopPullDownRefresh: fail"})}})}render(){const t=t=>{const{currSt:s,dragOnEdge:h,prefixCls:e}=this,a=r(t,!h&&`${e}-transition`);return i("div",{class:`${e}-content-wrapper`},i("div",{class:a,ref:t=>{this.contentRef=t}},("activate"===s||"release"===s)&&i("div",{class:`${e}-indicator`},i("div",null),i("div",null),i("div",null)),i("slot",null)))};return this.scrollContainer?t(`${this.prefixCls}-content ${this.prefixCls}-down`):i(h,{class:r(this.prefixCls,`${this.prefixCls}-down`)},t(`${this.prefixCls}-content`))}get el(){return e(this)}static get watchers(){return{currSt:["statusChange"]}}static get style(){return".rmc-pull-to-refresh-content{-webkit-transform-origin:left top 0;transform-origin:left top 0}.rmc-pull-to-refresh-content-wrapper{overflow:hidden}.rmc-pull-to-refresh-transition{-webkit-transition:-webkit-transform .3s;transition:-webkit-transform .3s;transition:transform .3s;transition:transform .3s,-webkit-transform .3s}\@-webkit-keyframes rmc-pull-to-refresh-indicator{50%{opacity:.2}to{opacity:1}}\@keyframes rmc-pull-to-refresh-indicator{50%{opacity:.2}to{opacity:1}}.rmc-pull-to-refresh-indicator{text-align:center;height:30px;line-height:10px}.rmc-pull-to-refresh-indicator>div{background-color:grey;width:6px;height:6px;border-radius:100%;margin:3px;-webkit-animation-fill-mode:both;animation-fill-mode:both;display:inline-block;-webkit-animation:rmc-pull-to-refresh-indicator .5s linear 0s infinite;animation:rmc-pull-to-refresh-indicator .5s linear 0s infinite}.rmc-pull-to-refresh-indicator>div:nth-child(0){-webkit-animation-delay:-.1s!important;animation-delay:-.1s!important}.rmc-pull-to-refresh-indicator>div:first-child{-webkit-animation-delay:-.2s!important;animation-delay:-.2s!important}.rmc-pull-to-refresh-indicator>div:nth-child(2){-webkit-animation-delay:-.3s!important;animation-delay:-.3s!important}.rmc-pull-to-refresh-down .rmc-pull-to-refresh-indicator{margin-top:-25px}"}};export{d as taro_pull_to_refresh};
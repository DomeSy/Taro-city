import{r as t,h as i,c as s,H as e,g as h}from"./p-afb5cad8.js";import{c as n}from"./p-cff38696.js";function r(t,i){const s=[];for(let e=t;e<=i;e++)s.push(`${e<10?"0":""}${e}`);return s}const o=["20","21","22","23",...r(0,23),"00","01","02","03"],a=["56","57","58","59",...r(0,59),"00","01","02","03"];function c(t,i){return!isNaN(+t)&&t>=0&&t<i.length}function u(t){if(!/^\d{1,2}:\d{1,2}$/.test(t))return!1;const i=t.split(":").map(t=>+t);return!(i[0]<0||i[0]>23||i[1]<0||i[1]>59)}function l(t,i){const s=t.split(":").map(t=>+t),e=i.split(":").map(t=>+t);return s[0]<e[0]||s[0]===e[0]&&s[1]<=e[1]}function d(t){if(!t)return!1;const i=new Date(t.replace(/-/g,"/"));return!isNaN(i.getMonth())&&i}function p(t){let i;return i=Array.isArray(t)?t.map(t=>String(t)):t,i}function g(t,i){const s=[];for(let e=t;e<=i;e++)s.push(e);return s}function m(t,i){return g(t,i)}function f(t,i,s){let e=1,h=12;return t.getFullYear()===s&&(e=t.getMonth()+1),i.getFullYear()===s&&(h=i.getMonth()+1),g(e,h)}function _(t,i,s,e){let h=1,n=function(t,i){return 4===i||6===i||9===i||11===i?30:2===i?t%4==0&&t%100!=0||t%400==0?29:28:31}(s,e);return t.getFullYear()===s&&t.getMonth()+1===e&&(h=t.getDate()),i.getFullYear()===s&&i.getMonth()+1===e&&(n=i.getDate()),g(h,n)}const k=class{constructor(e){t(this,e),this.index=[],this.mode="selector",this.disabled=!1,this.range=[],this.start="",this.end="",this.fields="day",this.name="",this.pickerValue=[],this.height=[],this.hidden=!0,this.fadeOut=!1,this.showPicker=()=>{this.disabled||(this.height=this.getHeightByIndex(),this.hidden=!1)},this.getHeightByIndex=()=>this.index.map(t=>{let i=0;return"time"===this.mode&&(i=136),102-34*t-i}),this.hidePicker=()=>{this.fadeOut=!0,setTimeout(()=>{this.hidden=!0,this.fadeOut=!1},350)},this.handleChange=()=>{this.hidePicker(),this.index=this.height.map(t=>(102-t)/34);let t=this.index.length&&"selector"!==this.mode?this.index:this.index[0];if("time"===this.mode){const i=[o.slice(),a.slice()],s=this.index.map((t,s)=>i[s][t]);this.index=s.map(t=>parseInt(t)),t=s.join(":")}if("date"===this.mode){const{_start:i,_end:s,_updateValue:e}=this.pickerDate,h=e[0],n=e[1],r=m(i.getFullYear(),s.getFullYear()),o=f(i,s,h),a=_(i,s,h,n),c=r[this.index[0]],u=o[this.index[1]],l=a[this.index[2]];t="year"===this.fields?[c]:"month"===this.fields?[c,u]:[c,u,l],t=t.map(t=>t<10?`0${t}`:t).join("-")}this.pickerValue=t,this.onChange.emit({value:t})},this.handleCancel=()=>{this.hidePicker(),this.onCancel.emit()},this.updateHeight=(t,i,s=!1)=>{const e=[...this.height];if(e[i]=t,this.height=e,s){let{start:t,end:i}=this;if(u(t)||(t="00:00"),u(i)||(i="23:59"),!l(t,i))return;const s=[o.slice(),a.slice()],e=this.height.map(t=>(102-t)/34).map((t,i)=>s[i][t]).join(":");if(l(t,e)){if(!l(e,i)){const t=i.split(":").map(t=>102-34*(+t+4));requestAnimationFrame(()=>this.height=t)}}else{const i=t.split(":").map(t=>102-34*(+t+4));requestAnimationFrame(()=>this.height=i)}}},this.handleColumnChange=(t,i)=>{this.onColumnChange.emit({column:Number(i),value:(102-t)/34})},this.updateDay=(t,i)=>{const{_start:s,_end:e,_updateValue:h}=this.pickerDate;h[i]=t;const n=h[0],r=h[1],o=h[2];if(0===i){const t=f(s,e,n),i=t[t.length-1],o=t[0];r>i&&(h[1]=i),r<o&&(h[1]=o);const a=102-34*t.indexOf(h[1]);this.updateDay(h[1],1),this.updateHeight(a,"1")}else if(1===i){const t=_(s,e,n,r),i=t[t.length-1],a=t[0];o>i&&(h[2]=i),o<a&&(h[2]=a);const c=102-34*t.indexOf(h[2]);this.updateDay(h[2],2),this.updateHeight(c,"2")}},this.getSelector=()=>i("taro-picker-group",{range:this.range,rangeKey:this.rangeKey,height:this.height[0],updateHeight:this.updateHeight,columnId:"0"}),this.getMultiSelector=()=>this.range.map((t,s)=>i("taro-picker-group",{range:t,rangeKey:this.rangeKey,height:this.height[s],updateHeight:this.updateHeight,onColumnChange:this.handleColumnChange,columnId:String(s)})),this.getTimeSelector=()=>{const t=o.slice(),s=a.slice();return[i("taro-picker-group",{mode:"time",range:t,height:this.height[0],updateHeight:this.updateHeight,columnId:"0"}),i("taro-picker-group",{mode:"time",range:s,height:this.height[1],updateHeight:this.updateHeight,columnId:"1"})]},this.getDateSelector=()=>{const{fields:t,height:s}=this,{_start:e,_end:h,_updateValue:n}=this.pickerDate,r=n[0],o=n[1],a=m(e.getFullYear(),h.getFullYear()).map(t=>`${t}年`),c=f(e,h,r).map(t=>`${t<10?`0${t}`:t}月`),u=_(e,h,r,o).map(t=>`${t<10?`0${t}`:t}日`),l=[i("taro-picker-group",{mode:"date",range:a,height:s[0],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"0"})];return"month"!==t&&"day"!==t||l.push(i("taro-picker-group",{mode:"date",range:c,height:s[1],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"1"})),"day"===t&&l.push(i("taro-picker-group",{mode:"date",range:u,height:s[2],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"2"})),l},this.onChange=s(this,"change",7),this.onColumnChange=s(this,"columnchange",7),this.onCancel=s(this,"cancel",7)}componentWillLoad(){this.handleProps()}componentDidLoad(){Object.defineProperty(this.el,"value",{get:()=>this.pickerValue,set:t=>this.value=t,configurable:!0})}onPropsChange(){this.handleProps()}handleProps(){const{mode:t,start:i,end:s}=this;if("selector"===t){const t=this.value;this.index=[c(t,this.range)?Math.floor(t):0]}else if("multiSelector"===t){const t=this.value;this.index=[],this.range.forEach((i,s)=>{const e=null==t?void 0:t[s],h=c(e,i)?Math.floor(e):0;this.index.push(h)})}else if("time"===t){let t=this.value;u(t)||(console.warn("time picker value illegal"),t="0:0");const i=t.split(":").map(t=>+t);this.index=i}else if("date"===t){const t=d(this.value)||new Date((new Date).setHours(0,0,0,0)),e=d(i)||new Date("1970/01/01"),h=d(s)||new Date("2999/01/01");if(!(t>=e&&t<=h))throw new Error("Date Interval Error");{const i=t.getFullYear(),s=t.getMonth()+1,n=t.getDate(),r=m(e.getFullYear(),h.getFullYear()),o=f(e,h,i),a=_(e,h,i,s);this.index=[r.indexOf(i),o.indexOf(s),a.indexOf(n)],this.pickerDate&&this.pickerDate._value.getTime()===t.getTime()&&this.pickerDate._start.getTime()===e.getTime()&&this.pickerDate._end.getTime()===h.getTime()||(this.pickerDate={_value:t,_start:e,_end:h,_updateValue:[i,s,n]})}}if(this.height=this.getHeightByIndex(),this.pickerValue=this.value,"date"===t){const t=this.pickerValue;"month"===this.fields?this.pickerValue=t.split("-").slice(0,2).join("-"):"year"===this.fields&&(this.pickerValue=t.split("-")[0])}}render(){const{name:t,mode:s,fadeOut:h,hidden:r}=this;let o;switch(s){case"multiSelector":o=this.getMultiSelector();break;case"time":o=this.getTimeSelector();break;case"date":o=this.getDateSelector();break;default:o=this.getSelector()}const a=n("weui-mask","weui-animate-fade-in",{"weui-animate-fade-out":h}),c=n("weui-picker","weui-animate-slide-up",{"weui-animate-slide-down":h}),u=r?{display:"none"}:{};return i(e,null,i("div",{onClick:this.showPicker},i("slot",null)),i("div",{style:u,class:a,onClick:this.handleCancel}),i("div",{style:u,class:c},i("div",{class:"weui-picker__hd"},i("div",{class:"weui-picker__action",onClick:this.handleCancel},"取消"),i("div",{class:"weui-picker__action",onClick:this.handleChange},"确定")),i("div",{class:"weui-picker__bd"},o),i("input",{type:"hidden",name:t,value:p(this.pickerValue)})))}get el(){return h(this)}static get watchers(){return{mode:["onPropsChange"],value:["onPropsChange"],range:["onPropsChange"],start:["onPropsChange"],end:["onPropsChange"]}}static get style(){return".weui-picker,.weui-picker__hd{font-size:12px}"}},w=class{constructor(i){t(this,i),this.range=[]}getPosition(){const t=`translate3d(0, ${this.height}px, 0)`,i=`transform ${this.touchEnd?.3:0}s`;return{transform:t,"-webkit-transform":t,transition:i,"-webkit-transition":i}}formulaUnlimitedScroll(t,i,s){const{height:e,updateHeight:h,columnId:n}=this,r="up"===s?1:-1;this.touchEnd=!1,h(-t*r*34+e,n),requestAnimationFrame(()=>{this.touchEnd=!0;const s=Math.round(i/-34)+t*r;h(102-34*s,n,!0)})}onTouchStart(t){this.startY=t.changedTouches[0].clientY,this.preY=t.changedTouches[0].clientY,this.hadMove=!1}onTouchMove(t){t.preventDefault();const i=t.changedTouches[0].clientY,s=i-this.preY;this.preY=i,this.touchEnd=!1,Math.abs(i-this.startY)>10&&(this.hadMove=!0);let e=this.height+s;"time"===this.mode&&("0"===this.columnId?(e>0&&(e=-816+s),e<-850&&(e=-34+s)):"1"===this.columnId&&(e>0&&(e=-2040+s),e<-2074&&(e=-34+s))),this.updateHeight(e,this.columnId)}onTouchEnd(t){const{mode:i,range:s,height:e,updateHeight:h,onColumnChange:n,columnId:r}=this,o=-34*(s.length-1),a=t.changedTouches[0].clientY;let c;if(this.touchEnd=!0,this.hadMove)c=e-102;else if(c=e-102-(a-(window.innerHeight-119)),"time"===i)if("0"===r){if(c>-85)return this.formulaUnlimitedScroll(24,c,"up");if(c<-969)return this.formulaUnlimitedScroll(24,c,"down")}else if("1"===r){if(c>-85)return this.formulaUnlimitedScroll(60,c,"up");if(c<-2193)return this.formulaUnlimitedScroll(60,c,"down")}c>0&&(c=0),c<o&&(c=o);const u=Math.round(c/-34),l=102-34*u;"date"===this.mode&&("0"===this.columnId&&this.updateDay(+this.range[u].replace(/[^0-9]/gi,""),0),"1"===this.columnId&&this.updateDay(+this.range[u].replace(/[^0-9]/gi,""),1),"2"===this.columnId&&this.updateDay(+this.range[u].replace(/[^0-9]/gi,""),2)),h(l,r,"time"===i),n&&n(l,r)}render(){const{range:t,rangeKey:s}=this,h=t.map(t=>i("div",{class:"weui-picker__item"},s?t[s]:t));return i(e,{class:"weui-picker__group"},i("div",{class:"weui-picker__mask"}),i("div",{class:"weui-picker__indicator"}),i("div",{class:"weui-picker__content",style:this.getPosition()},h))}};export{k as taro_picker_core,w as taro_picker_group};
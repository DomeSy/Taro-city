{"version":3,"file":"jsonp.dev.js","sources":["../node_modules/object-assign/index.js","../src/lib.js","../src/store.js","../src/jsonp.js"],"sourcesContent":["/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","const enc = encodeURIComponent\n\nexport function serializeParams (params) {\n  if (!params) {\n    return ''\n  }\n  return Object.keys(params)\n    .map(item => (`${item}=${enc(params[item])}`)).join('&')\n}\n\nexport function isFunction (fn) {\n  return typeof fn === 'function'\n}\n\nexport function getUrlQueryParamByName (url, name) {\n  if (!url) {\n    url = window.location.href\n  }\n  name = name.replace(/[[]]/g, '\\\\$&')\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)')\n  const results = regex.exec(url)\n  if (!results) {\n    return null\n  }\n  if (!results[2]) {\n    return ''\n  }\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '))\n}\n\nexport function updateQueryStringParamByName (url, name, value) {\n  const re = new RegExp('([?&])' + name + '=.*?(&|$)', 'i')\n  const separator = url.indexOf('?') !== -1 ? '&' : '?'\n  if (url.match(re)) {\n    return url.replace(re, '$1' + name + '=' + value + '$2')\n  }\n  return url + separator + name + '=' + value\n}\n","const win = (typeof window !== 'undefined' ? window : global)\nconst localStorageName = 'localStorage'\nconst storage = win[localStorageName]\n\nconst store = {\n  disabled: false,\n  set (key, val) {\n    if (val === void 666) {\n      return store.remove(key)\n    }\n    storage.setItem(key, store.serialize(val))\n    return val\n  },\n  get (key, defaultVal) {\n    const val = store.deserialize(storage.getItem(key))\n    return (val === undefined ? defaultVal : val)\n  },\n  remove (key) {\n    storage.removeItem(key)\n  },\n  clear () {\n    storage.clear()\n  },\n  has (key) {\n    return store.get(key) !== void 666\n  },\n  forEach (callback) {\n    for (let i = 0; i < storage.length; i++) {\n      const key = storage.key(i)\n      callback(key, store.get(key))\n    }\n  },\n  getAll () {\n    const ret = {}\n    store.forEach((key, val) => {\n      ret[key] = val\n    })\n    return ret\n  },\n  serialize (value) {\n    return JSON.stringify(value)\n  },\n  deserialize (value) {\n    if (typeof value !== 'string') {\n      return\n    }\n    try {\n      return JSON.parse(value)\n    } catch (err) {\n      return value || void 666\n    }\n  }\n}\n\ntry {\n  const testKey = '__store__'\n  store.set(testKey, testKey)\n  if (store.get(testKey) !== testKey) {\n    store.disabled = true\n  }\n  store.remove(testKey)\n} catch (err) {\n  store.disabled = true\n}\nstore.enabled = !store.disabled\n\nexport default store\n","import assign from 'object-assign'\n\nimport { serializeParams, isFunction, getUrlQueryParamByName, updateQueryStringParamByName } from './lib'\nimport store from './store'\n\nconst win = typeof window !== 'undefined' ? window : global\n\nconst canUsePromise = (function () {\n  return 'Promise' in win &&\n    typeof isFunction(Promise)\n})()\n\nconst noop = function () {}\n\nconst encodeC = encodeURIComponent\nconst doc = win.document\nconst head = doc ? (doc.head || doc.getElementsByTagName('head')[0]) : null\n\nconst TIMEOUT_CONST = 2000\n\nconst defaultConfig = {\n  timeout: TIMEOUT_CONST,\n  retryTimes: 2,\n  backup: null,\n  params: {},\n  jsonp: 'callback',\n  name: null,\n  cache: false,\n  useStore: false,\n  storeCheck: null,\n  storeSign: null,\n  storeCheckKey: null,\n  dataCheck: null,\n  charset: 'UTF-8'\n}\n\nlet timestamp = new Date().getTime()\n\nfunction jsonp (url, opts, cb) {\n  if (isFunction(url)) {\n    cb = url\n    opts = {}\n  } else if (url && typeof url === 'object') {\n    cb = opts\n    opts = url || {}\n    url = opts.url\n  }\n  if (isFunction(opts)) {\n    cb = opts\n    opts = {}\n  }\n  if (!opts) {\n    opts = {}\n  }\n  opts = assign({}, defaultConfig, opts)\n  url = url || opts.url\n  cb = cb || noop\n  if (!url || typeof url !== 'string') {\n    cb(new Error('Param url is needed!'))\n    if (!jsonp.promiseClose && canUsePromise) {\n      return new Promise((resolve, reject) => {\n        return reject(new Error('Param url is needed!'))\n      })\n    }\n    return\n  }\n  const urlWithParams = generateJsonpUrlWithParams(url, opts.params)\n  // first get data from store\n  const datafromStore = getDataFromStore({\n    useStore: opts.useStore,\n    storeKey: urlWithParams,\n    storeCheck: opts.storeCheck,\n    storeCheckKey: opts.storeCheckKey,\n    storeSign: opts.storeSign,\n    dataCheck: opts.dataCheck\n  })\n  if (datafromStore) {\n    cb(null, datafromStore)\n    if (!jsonp.promiseClose && canUsePromise) {\n      return new Promise(resolve => {\n        return resolve(datafromStore)\n      })\n    }\n    return\n  }\n  opts.originalUrl = urlWithParams\n  if (!jsonp.promiseClose && canUsePromise) {\n    return new Promise((resolve, reject) => {\n      fetchData(urlWithParams, opts, (err, data) => {\n        if (err) {\n          cb(err)\n          return reject(err)\n        }\n        cb(null, data)\n        resolve(data)\n      })\n    })\n  }\n  fetchData(urlWithParams, opts, cb)\n}\n\nfunction generateJsonpUrlWithParams (url, params) {\n  params = typeof params === 'string' ? params : serializeParams(params)\n  url += (~url.indexOf('?') ? '&' : '?') + `${params}`\n  url = url.replace('?&', '?')\n  return url\n}\n\nfunction fetchData (url, opts, cb) {\n  const originalUrl = opts.originalUrl\n  const charset = opts.charset\n  const jsonpUrlQueryParam = getUrlQueryParamByName(url, opts.jsonp)\n  const funcId = (jsonpUrlQueryParam === '?' ? false : jsonpUrlQueryParam) || opts.name || `__jsonp${timestamp++}`\n  const gotoBackupInfo = arguments[3] || null\n  if (jsonpUrlQueryParam) {\n    if (jsonpUrlQueryParam === '?') {\n      url = updateQueryStringParamByName(url, opts.jsonp, encodeC(funcId))\n    }\n  } else {\n    url += (url.split('').pop() === '&' ? '' : '&') + `${opts.jsonp}=${encodeC(funcId)}`\n  }\n  if (!opts.cache) {\n    url += (url.split('').pop() === '&' ? '' : '&') + `_=${new Date().getTime()}`\n  }\n\n  // move prev callback into next when fetch parallel with same funcId\n  clearTimeout(win['timer_' + funcId])\n  const prevFunc = win[funcId]\n  win[funcId] = function (data) {\n    prevFunc && prevFunc(data)\n    cleanup(funcId)\n    if (gotoBackupInfo) {\n      data.__$$backupCall = gotoBackupInfo\n    }\n    if (opts.dataCheck) {\n      if (opts.dataCheck(data) !== false) {\n        // write data to store\n        setDataToStore({\n          useStore: opts.useStore,\n          storeKey: originalUrl,\n          data\n        })\n        return cb(null, data)\n      }\n      if (fallback(originalUrl, opts, cb) === false) {\n        cb(new Error('Data check error, and no fallback'))\n      }\n    } else {\n      // write data to store\n      setDataToStore({\n        useStore: opts.useStore,\n        storeKey: originalUrl,\n        data\n      })\n      cb(null, data)\n    }\n  }\n  const script = appendScriptTagToHead({\n    url,\n    charset\n  })\n\n  const timeout = opts.timeout != null ? opts.timeout : TIMEOUT_CONST\n  // when timeout, will try to retry\n  win['timer_' + funcId] = setTimeout(() => {\n    cleanup(funcId)\n    // no retryTimes left, go to backup\n    if (typeof opts.retryTimes === 'number' && opts.retryTimes > 0) {\n      opts.retryTimes--\n      return fetchData(originalUrl, opts, cb)\n    }\n    if (fallback(originalUrl, opts, cb) === false) {\n      return cb(new Error('Timeout and no data return'))\n    }\n  }, timeout)\n\n  function cleanup (funcId) {\n    if (script.parentNode) {\n      script.parentNode.removeChild(script)\n    }\n    win[funcId] = noop\n    clearTimeout(win['timer_' + funcId])\n  }\n}\n\nfunction storeCheckFn (storeData, storeCheckKey, storeSign) {\n  if (storeData && storeCheckKey && storeSign) {\n    return storeData[storeCheckKey] && storeData[storeCheckKey] === storeSign\n  }\n  return false\n}\n\nfunction getDataFromStore ({ useStore, storeKey, storeCheck, storeCheckKey, storeSign, dataCheck }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    const storeData = store.get(storeKey)\n    storeCheck = storeCheck || storeCheckFn\n    if (storeCheck(storeData, storeCheckKey, storeSign)) {\n      if (!dataCheck || (storeData && dataCheck && dataCheck(storeData) !== false)) {\n        return storeData\n      }\n    }\n  }\n  return null\n}\n\nfunction getDataFromStoreWithoutCheck ({ useStore, storeKey, dataCheck }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    const storeData = store.get(storeKey)\n    if (!dataCheck || (storeData && dataCheck && dataCheck(storeData) !== false)) {\n      return storeData\n    }\n  }\n  return null\n}\n\nfunction setDataToStore ({ useStore, storeKey, data }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    store.set(storeKey, data)\n  }\n}\n\nfunction fallback (url, opts, cb) {\n  const backup = opts.backup\n  let backupWithParams\n  if (backup) {\n    if (typeof backup === 'string') {\n      delete opts.backup\n      backupWithParams = generateJsonpUrlWithParams(backup, opts.params)\n      return fetchData(backupWithParams, opts, cb, {\n        backup\n      })\n    } else if (Array.isArray(backup)) {\n      if (backup.length) {\n        const backupUrl = backup.shift()\n        backupWithParams = generateJsonpUrlWithParams(backupUrl, opts.params)\n        return fetchData(backupWithParams, opts, cb, {\n          backup: backupUrl\n        })\n      }\n    }\n  }\n  // no backup to use, try to get data from store\n  const dataFromStoreWithoutCheck = getDataFromStoreWithoutCheck({\n    useStore: opts.useStore,\n    storeKey: url,\n    dataCheck: opts.dataCheck\n  })\n  if (dataFromStoreWithoutCheck) {\n    cb(null, dataFromStoreWithoutCheck)\n    return true\n  }\n  return false\n}\n\nexport function appendScriptTagToHead ({ url, charset }) {\n  if (!doc) {\n    return\n  }\n  const script = doc.createElement('script')\n  script.type = 'text/javascript'\n  if (charset) {\n    script.charset = charset\n  }\n  script.src = url\n  head.appendChild(script)\n  return script\n}\n\nexport default jsonp\n"],"names":["enc","encodeURIComponent","serializeParams","params","Object","keys","map","item","join","isFunction","fn","getUrlQueryParamByName","url","name","window","location","href","replace","regex","RegExp","results","exec","decodeURIComponent","updateQueryStringParamByName","value","re","separator","indexOf","match","win","global","localStorageName","storage","store","key","val","remove","setItem","serialize","defaultVal","deserialize","getItem","undefined","removeItem","clear","get","callback","i","length","ret","forEach","JSON","stringify","parse","err","testKey","set","disabled","enabled","canUsePromise","Promise","noop","encodeC","doc","document","head","getElementsByTagName","TIMEOUT_CONST","defaultConfig","timestamp","Date","getTime","jsonp","opts","cb","assign","Error","promiseClose","resolve","reject","urlWithParams","generateJsonpUrlWithParams","datafromStore","getDataFromStore","useStore","storeCheck","storeCheckKey","storeSign","dataCheck","originalUrl","data","fetchData","charset","jsonpUrlQueryParam","funcId","gotoBackupInfo","arguments","split","pop","cache","prevFunc","__$$backupCall","fallback","script","appendScriptTagToHead","timeout","setTimeout","retryTimes","cleanup","parentNode","removeChild","storeCheckFn","storeData","storeKey","getDataFromStoreWithoutCheck","setDataToStore","backup","backupWithParams","Array","isArray","backupUrl","shift","dataFromStoreWithoutCheck","createElement","type","src","appendChild"],"mappings":"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"}
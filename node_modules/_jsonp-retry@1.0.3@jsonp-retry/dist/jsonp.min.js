!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.jsonp=r()}(this,function(){"use strict";function e(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function r(e){return e?Object.keys(e).map(function(r){return r+"="+g(e[r])}).join("&"):""}function t(e){return"function"==typeof e}function n(e,r){e||(e=window.location.href),r=r.replace(/[[]]/g,"\\$&");var t=RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)"),n=t.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function o(e,r,t){var n=RegExp("([?&])"+r+"=.*?(&|$)","i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+r+"="+t+"$2"):e+o+r+"="+t}function i(e,r,n){if(t(e)?(n=e,r={}):e&&"object"===(void 0===e?"undefined":C(e))&&(n=r,r=e||{},e=r.url),t(r)&&(n=r,r={}),r||(r={}),r=b({},P,r),e=e||r.url,n=n||w,e&&"string"==typeof e){var o=a(e,r.params),c=s({useStore:r.useStore,storeKey:o,storeCheck:r.storeCheck,storeCheckKey:r.storeCheckKey,storeSign:r.storeSign,dataCheck:r.dataCheck});if(c){if(n(null,c),!i.promiseClose&&S)return new Promise(function(e){return e(c)})}else{if(r.originalUrl=o,!i.promiseClose&&S)return new Promise(function(e,t){u(o,r,function(r,o){if(r)return n(r),t(r);n(null,o),e(o)})});u(o,r,n)}}else if(n(Error("Param url is needed!")),!i.promiseClose&&S)return new Promise(function(e,r){return r(Error("Param url is needed!"))})}function a(e,t){return t="string"==typeof t?t:r(t),e+=(~e.indexOf("?")?"&":"?")+t,e=e.replace("?&","?")}function u(e,r,t){function i(e){h.parentNode&&h.parentNode.removeChild(h),j[e]=w,clearTimeout(j["timer_"+e])}var a=r.originalUrl,c=r.charset,s=n(e,r.jsonp),l="?"!==s&&s||r.name||"__jsonp"+x++,m=arguments[3]||null;s?"?"===s&&(e=o(e,r.jsonp,O(l))):e+=("&"===e.split("").pop()?"":"&")+r.jsonp+"="+O(l),r.cache||(e+=("&"===e.split("").pop()?"":"&")+"_="+(new Date).getTime()),clearTimeout(j["timer_"+l]);var y=j[l];j[l]=function(e){if(y&&y(e),i(l),m&&(e.__$$backupCall=m),r.dataCheck){if(!1!==r.dataCheck(e))return f({useStore:r.useStore,storeKey:a,data:e}),t(null,e);!1===d(a,r,t)&&t(Error("Data check error, and no fallback"))}else f({useStore:r.useStore,storeKey:a,data:e}),t(null,e)};var h=p({url:e,charset:c}),b=null!=r.timeout?r.timeout:K;j["timer_"+l]=setTimeout(function(){return i(l),"number"==typeof r.retryTimes&&r.retryTimes>0?(r.retryTimes--,u(a,r,t)):!1===d(a,r,t)?t(Error("Timeout and no data return")):void 0},b)}function c(e,r,t){return!!(e&&r&&t)&&(e[r]&&e[r]===t)}function s(e){var r=e.useStore,t=e.storeKey,n=e.storeCheck,o=e.storeCheckKey,i=e.storeSign,a=e.dataCheck;if(r=!!r&&_.enabled){var u=_.get(t);if((n=n||c)(u,o,i)&&(!a||u&&a&&!1!==a(u)))return u}return null}function l(e){var r=e.useStore,t=e.storeKey,n=e.dataCheck;if(r=!!r&&_.enabled){var o=_.get(t);if(!n||o&&n&&!1!==n(o))return o}return null}function f(e){var r=e.useStore,t=e.storeKey,n=e.data;(r=!!r&&_.enabled)&&_.set(t,n)}function d(e,r,t){var n=r.backup,o=void 0;if(n){if("string"==typeof n)return delete r.backup,o=a(n,r.params),u(o,r,t,{backup:n});if(Array.isArray(n)&&n.length){var i=n.shift();return o=a(i,r.params),u(o,r,t,{backup:i})}}var c=l({useStore:r.useStore,storeKey:e,dataCheck:r.dataCheck});return!!c&&(t(null,c),!0)}function p(e){var r=e.url,t=e.charset;if(E){var n=E.createElement("script");return n.type="text/javascript",t&&(n.charset=t),n.src=r,T.appendChild(n),n}}var m=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,b=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var r={},t=0;t<10;t++)r["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(r).map(function(e){return r[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(r){for(var t,n,o=e(r),i=1;i<arguments.length;i++){t=Object(arguments[i]);for(var a in t)y.call(t,a)&&(o[a]=t[a]);if(m){n=m(t);for(var u=0;u<n.length;u++)h.call(t,n[u])&&(o[n[u]]=t[n[u]])}}return o},g=encodeURIComponent,v="undefined"!=typeof window?window:global,k=v["localStorage"],_={disabled:!1,set:function(e,r){return void 0===r?_.remove(e):(k.setItem(e,_.serialize(r)),r)},get:function(e,r){var t=_.deserialize(k.getItem(e));return void 0===t?r:t},remove:function(e){k.removeItem(e)},clear:function(){k.clear()},has:function(e){return void 0!==_.get(e)},forEach:function(e){for(var r=0;r<k.length;r++){var t=k.key(r);e(t,_.get(t))}},getAll:function(){var e={};return _.forEach(function(r,t){e[r]=t}),e},serialize:function(e){return JSON.stringify(e)},deserialize:function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(r){return e||void 0}}};try{_.set("__store__","__store__"),"__store__"!==_.get("__store__")&&(_.disabled=!0),_.remove("__store__")}catch(e){_.disabled=!0}_.enabled=!_.disabled;var C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j="undefined"!=typeof window?window:global,S=function(){return"Promise"in j&&C(t(Promise))}(),w=function(){},O=encodeURIComponent,E=j.document,T=E?E.head||E.getElementsByTagName("head")[0]:null,K=2e3,P={timeout:K,retryTimes:2,backup:null,params:{},jsonp:"callback",name:null,cache:!1,useStore:!1,storeCheck:null,storeSign:null,storeCheckKey:null,dataCheck:null,charset:"UTF-8"},x=(new Date).getTime();return i});
//# sourceMappingURL=jsonp.min.js.map
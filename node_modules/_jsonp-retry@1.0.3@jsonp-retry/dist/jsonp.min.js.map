{"version":3,"sources":["../node_modules/object-assign/index.js","../src/lib.js","../src/jsonp.js","../src/store.js"],"names":["toObject","val","TypeError","Object","serializeParams","params","keys","map","item","enc","join","isFunction","fn","getUrlQueryParamByName","url","name","window","location","href","replace","regex","RegExp","results","exec","decodeURIComponent","updateQueryStringParamByName","value","re","separator","indexOf","match","jsonp","opts","cb","_typeof","assign","defaultConfig","noop","urlWithParams","generateJsonpUrlWithParams","datafromStore","getDataFromStore","useStore","storeCheck","storeCheckKey","storeSign","dataCheck","promiseClose","canUsePromise","Promise","resolve","originalUrl","reject","err","data","Error","fetchData","cleanup","funcId","script","parentNode","removeChild","win","charset","jsonpUrlQueryParam","timestamp","gotoBackupInfo","arguments","encodeC","split","pop","cache","Date","getTime","prevFunc","__$$backupCall","fallback","appendScriptTagToHead","timeout","TIMEOUT_CONST","setTimeout","retryTimes","storeCheckFn","storeData","_ref","storeKey","store","enabled","get","getDataFromStoreWithoutCheck","_ref2","setDataToStore","_ref3","set","backup","backupWithParams","Array","isArray","length","backupUrl","shift","dataFromStoreWithoutCheck","_ref4","doc","createElement","type","src","appendChild","getOwnPropertySymbols","hasOwnProperty","prototype","propIsEnumerable","propertyIsEnumerable","objectAssign$1","test1","String","getOwnPropertyNames","test2","i","fromCharCode","n","test3","forEach","letter","target","from","symbols","to","s","key","call","encodeURIComponent","global","storage","remove","setItem","serialize","defaultVal","deserialize","getItem","removeItem","clear","callback","ret","JSON","stringify","parse","disabled","document","head","getElementsByTagName"],"mappings":"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","file":"jsonp.min.js","sourcesContent":["/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","const enc = encodeURIComponent\n\nexport function serializeParams (params) {\n  if (!params) {\n    return ''\n  }\n  return Object.keys(params)\n    .map(item => (`${item}=${enc(params[item])}`)).join('&')\n}\n\nexport function isFunction (fn) {\n  return typeof fn === 'function'\n}\n\nexport function getUrlQueryParamByName (url, name) {\n  if (!url) {\n    url = window.location.href\n  }\n  name = name.replace(/[[]]/g, '\\\\$&')\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)')\n  const results = regex.exec(url)\n  if (!results) {\n    return null\n  }\n  if (!results[2]) {\n    return ''\n  }\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '))\n}\n\nexport function updateQueryStringParamByName (url, name, value) {\n  const re = new RegExp('([?&])' + name + '=.*?(&|$)', 'i')\n  const separator = url.indexOf('?') !== -1 ? '&' : '?'\n  if (url.match(re)) {\n    return url.replace(re, '$1' + name + '=' + value + '$2')\n  }\n  return url + separator + name + '=' + value\n}\n","import assign from 'object-assign'\n\nimport { serializeParams, isFunction, getUrlQueryParamByName, updateQueryStringParamByName } from './lib'\nimport store from './store'\n\nconst win = typeof window !== 'undefined' ? window : global\n\nconst canUsePromise = (function () {\n  return 'Promise' in win &&\n    typeof isFunction(Promise)\n})()\n\nconst noop = function () {}\n\nconst encodeC = encodeURIComponent\nconst doc = win.document\nconst head = doc ? (doc.head || doc.getElementsByTagName('head')[0]) : null\n\nconst TIMEOUT_CONST = 2000\n\nconst defaultConfig = {\n  timeout: TIMEOUT_CONST,\n  retryTimes: 2,\n  backup: null,\n  params: {},\n  jsonp: 'callback',\n  name: null,\n  cache: false,\n  useStore: false,\n  storeCheck: null,\n  storeSign: null,\n  storeCheckKey: null,\n  dataCheck: null,\n  charset: 'UTF-8'\n}\n\nlet timestamp = new Date().getTime()\n\nfunction jsonp (url, opts, cb) {\n  if (isFunction(url)) {\n    cb = url\n    opts = {}\n  } else if (url && typeof url === 'object') {\n    cb = opts\n    opts = url || {}\n    url = opts.url\n  }\n  if (isFunction(opts)) {\n    cb = opts\n    opts = {}\n  }\n  if (!opts) {\n    opts = {}\n  }\n  opts = assign({}, defaultConfig, opts)\n  url = url || opts.url\n  cb = cb || noop\n  if (!url || typeof url !== 'string') {\n    cb(new Error('Param url is needed!'))\n    if (!jsonp.promiseClose && canUsePromise) {\n      return new Promise((resolve, reject) => {\n        return reject(new Error('Param url is needed!'))\n      })\n    }\n    return\n  }\n  const urlWithParams = generateJsonpUrlWithParams(url, opts.params)\n  // first get data from store\n  const datafromStore = getDataFromStore({\n    useStore: opts.useStore,\n    storeKey: urlWithParams,\n    storeCheck: opts.storeCheck,\n    storeCheckKey: opts.storeCheckKey,\n    storeSign: opts.storeSign,\n    dataCheck: opts.dataCheck\n  })\n  if (datafromStore) {\n    cb(null, datafromStore)\n    if (!jsonp.promiseClose && canUsePromise) {\n      return new Promise(resolve => {\n        return resolve(datafromStore)\n      })\n    }\n    return\n  }\n  opts.originalUrl = urlWithParams\n  if (!jsonp.promiseClose && canUsePromise) {\n    return new Promise((resolve, reject) => {\n      fetchData(urlWithParams, opts, (err, data) => {\n        if (err) {\n          cb(err)\n          return reject(err)\n        }\n        cb(null, data)\n        resolve(data)\n      })\n    })\n  }\n  fetchData(urlWithParams, opts, cb)\n}\n\nfunction generateJsonpUrlWithParams (url, params) {\n  params = typeof params === 'string' ? params : serializeParams(params)\n  url += (~url.indexOf('?') ? '&' : '?') + `${params}`\n  url = url.replace('?&', '?')\n  return url\n}\n\nfunction fetchData (url, opts, cb) {\n  const originalUrl = opts.originalUrl\n  const charset = opts.charset\n  const jsonpUrlQueryParam = getUrlQueryParamByName(url, opts.jsonp)\n  const funcId = (jsonpUrlQueryParam === '?' ? false : jsonpUrlQueryParam) || opts.name || `__jsonp${timestamp++}`\n  const gotoBackupInfo = arguments[3] || null\n  if (jsonpUrlQueryParam) {\n    if (jsonpUrlQueryParam === '?') {\n      url = updateQueryStringParamByName(url, opts.jsonp, encodeC(funcId))\n    }\n  } else {\n    url += (url.split('').pop() === '&' ? '' : '&') + `${opts.jsonp}=${encodeC(funcId)}`\n  }\n  if (!opts.cache) {\n    url += (url.split('').pop() === '&' ? '' : '&') + `_=${new Date().getTime()}`\n  }\n\n  // move prev callback into next when fetch parallel with same funcId\n  clearTimeout(win['timer_' + funcId])\n  const prevFunc = win[funcId]\n  win[funcId] = function (data) {\n    prevFunc && prevFunc(data)\n    cleanup(funcId)\n    if (gotoBackupInfo) {\n      data.__$$backupCall = gotoBackupInfo\n    }\n    if (opts.dataCheck) {\n      if (opts.dataCheck(data) !== false) {\n        // write data to store\n        setDataToStore({\n          useStore: opts.useStore,\n          storeKey: originalUrl,\n          data\n        })\n        return cb(null, data)\n      }\n      if (fallback(originalUrl, opts, cb) === false) {\n        cb(new Error('Data check error, and no fallback'))\n      }\n    } else {\n      // write data to store\n      setDataToStore({\n        useStore: opts.useStore,\n        storeKey: originalUrl,\n        data\n      })\n      cb(null, data)\n    }\n  }\n  const script = appendScriptTagToHead({\n    url,\n    charset\n  })\n\n  const timeout = opts.timeout != null ? opts.timeout : TIMEOUT_CONST\n  // when timeout, will try to retry\n  win['timer_' + funcId] = setTimeout(() => {\n    cleanup(funcId)\n    // no retryTimes left, go to backup\n    if (typeof opts.retryTimes === 'number' && opts.retryTimes > 0) {\n      opts.retryTimes--\n      return fetchData(originalUrl, opts, cb)\n    }\n    if (fallback(originalUrl, opts, cb) === false) {\n      return cb(new Error('Timeout and no data return'))\n    }\n  }, timeout)\n\n  function cleanup (funcId) {\n    if (script.parentNode) {\n      script.parentNode.removeChild(script)\n    }\n    win[funcId] = noop\n    clearTimeout(win['timer_' + funcId])\n  }\n}\n\nfunction storeCheckFn (storeData, storeCheckKey, storeSign) {\n  if (storeData && storeCheckKey && storeSign) {\n    return storeData[storeCheckKey] && storeData[storeCheckKey] === storeSign\n  }\n  return false\n}\n\nfunction getDataFromStore ({ useStore, storeKey, storeCheck, storeCheckKey, storeSign, dataCheck }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    const storeData = store.get(storeKey)\n    storeCheck = storeCheck || storeCheckFn\n    if (storeCheck(storeData, storeCheckKey, storeSign)) {\n      if (!dataCheck || (storeData && dataCheck && dataCheck(storeData) !== false)) {\n        return storeData\n      }\n    }\n  }\n  return null\n}\n\nfunction getDataFromStoreWithoutCheck ({ useStore, storeKey, dataCheck }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    const storeData = store.get(storeKey)\n    if (!dataCheck || (storeData && dataCheck && dataCheck(storeData) !== false)) {\n      return storeData\n    }\n  }\n  return null\n}\n\nfunction setDataToStore ({ useStore, storeKey, data }) {\n  useStore = useStore ? store.enabled : false\n  if (useStore) {\n    store.set(storeKey, data)\n  }\n}\n\nfunction fallback (url, opts, cb) {\n  const backup = opts.backup\n  let backupWithParams\n  if (backup) {\n    if (typeof backup === 'string') {\n      delete opts.backup\n      backupWithParams = generateJsonpUrlWithParams(backup, opts.params)\n      return fetchData(backupWithParams, opts, cb, {\n        backup\n      })\n    } else if (Array.isArray(backup)) {\n      if (backup.length) {\n        const backupUrl = backup.shift()\n        backupWithParams = generateJsonpUrlWithParams(backupUrl, opts.params)\n        return fetchData(backupWithParams, opts, cb, {\n          backup: backupUrl\n        })\n      }\n    }\n  }\n  // no backup to use, try to get data from store\n  const dataFromStoreWithoutCheck = getDataFromStoreWithoutCheck({\n    useStore: opts.useStore,\n    storeKey: url,\n    dataCheck: opts.dataCheck\n  })\n  if (dataFromStoreWithoutCheck) {\n    cb(null, dataFromStoreWithoutCheck)\n    return true\n  }\n  return false\n}\n\nexport function appendScriptTagToHead ({ url, charset }) {\n  if (!doc) {\n    return\n  }\n  const script = doc.createElement('script')\n  script.type = 'text/javascript'\n  if (charset) {\n    script.charset = charset\n  }\n  script.src = url\n  head.appendChild(script)\n  return script\n}\n\nexport default jsonp\n","const win = (typeof window !== 'undefined' ? window : global)\nconst localStorageName = 'localStorage'\nconst storage = win[localStorageName]\n\nconst store = {\n  disabled: false,\n  set (key, val) {\n    if (val === void 666) {\n      return store.remove(key)\n    }\n    storage.setItem(key, store.serialize(val))\n    return val\n  },\n  get (key, defaultVal) {\n    const val = store.deserialize(storage.getItem(key))\n    return (val === undefined ? defaultVal : val)\n  },\n  remove (key) {\n    storage.removeItem(key)\n  },\n  clear () {\n    storage.clear()\n  },\n  has (key) {\n    return store.get(key) !== void 666\n  },\n  forEach (callback) {\n    for (let i = 0; i < storage.length; i++) {\n      const key = storage.key(i)\n      callback(key, store.get(key))\n    }\n  },\n  getAll () {\n    const ret = {}\n    store.forEach((key, val) => {\n      ret[key] = val\n    })\n    return ret\n  },\n  serialize (value) {\n    return JSON.stringify(value)\n  },\n  deserialize (value) {\n    if (typeof value !== 'string') {\n      return\n    }\n    try {\n      return JSON.parse(value)\n    } catch (err) {\n      return value || void 666\n    }\n  }\n}\n\ntry {\n  const testKey = '__store__'\n  store.set(testKey, testKey)\n  if (store.get(testKey) !== testKey) {\n    store.disabled = true\n  }\n  store.remove(testKey)\n} catch (err) {\n  store.disabled = true\n}\nstore.enabled = !store.disabled\n\nexport default store\n"]}
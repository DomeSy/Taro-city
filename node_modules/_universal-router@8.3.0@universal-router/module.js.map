{"version":3,"file":"module.js","sources":["src/matchPath.js","src/matchRoute.js","src/resolveRoute.js","src/isChildRoute.js","src/UniversalRouter.js"],"sourcesContent":["/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport pathToRegexp from 'path-to-regexp'\n\nconst { hasOwnProperty } = Object.prototype\nconst cache = new Map()\n\nfunction decodeParam(val) {\n  try {\n    return decodeURIComponent(val)\n  } catch (err) {\n    return val\n  }\n}\n\nfunction matchPath(route, pathname, parentKeys, parentParams) {\n  const end = !route.children\n  const cacheKey = `${route.path || ''}|${end}`\n  let regexp = cache.get(cacheKey)\n\n  if (!regexp) {\n    const keys = []\n    regexp = {\n      keys,\n      pattern: pathToRegexp(route.path || '', keys, { end }),\n    }\n    cache.set(cacheKey, regexp)\n  }\n\n  const m = regexp.pattern.exec(pathname)\n  if (!m) {\n    return null\n  }\n\n  const path = m[0]\n  const params = { ...parentParams }\n\n  for (let i = 1; i < m.length; i++) {\n    const key = regexp.keys[i - 1]\n    const prop = key.name\n    const value = m[i]\n    if (value !== undefined || !hasOwnProperty.call(params, prop)) {\n      if (key.repeat) {\n        params[prop] = value ? value.split(key.delimiter).map(decodeParam) : []\n      } else {\n        params[prop] = value ? decodeParam(value) : value\n      }\n    }\n  }\n\n  return {\n    path: !end && path.charAt(path.length - 1) === '/' ? path.substr(1) : path,\n    keys: parentKeys.concat(regexp.keys),\n    params,\n  }\n}\n\nexport default matchPath\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport matchPath from './matchPath'\n\nfunction matchRoute(route, baseUrl, pathname, parentKeys, parentParams) {\n  let match\n  let childMatches\n  let childIndex = 0\n\n  return {\n    next(routeToSkip) {\n      if (route === routeToSkip) {\n        return { done: true }\n      }\n\n      if (!match) {\n        match = matchPath(route, pathname, parentKeys, parentParams)\n\n        if (match) {\n          return {\n            done: false,\n            value: {\n              route,\n              baseUrl,\n              path: match.path,\n              keys: match.keys,\n              params: match.params,\n            },\n          }\n        }\n      }\n\n      if (match && route.children) {\n        while (childIndex < route.children.length) {\n          if (!childMatches) {\n            const childRoute = route.children[childIndex]\n            childRoute.parent = route\n\n            childMatches = matchRoute(\n              childRoute,\n              baseUrl + match.path,\n              pathname.substr(match.path.length),\n              match.keys,\n              match.params,\n            )\n          }\n\n          const childMatch = childMatches.next(routeToSkip)\n          if (!childMatch.done) {\n            return {\n              done: false,\n              value: childMatch.value,\n            }\n          }\n\n          childMatches = null\n          childIndex++\n        }\n      }\n\n      return { done: true }\n    },\n  }\n}\n\nexport default matchRoute\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nfunction resolveRoute(context, params) {\n  if (typeof context.route.action === 'function') {\n    return context.route.action(context, params)\n  }\n  return undefined\n}\n\nexport default resolveRoute\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nfunction isChildRoute(parentRoute, childRoute) {\n  let route = childRoute\n  while (route) {\n    route = route.parent\n    if (route === parentRoute) {\n      return true\n    }\n  }\n  return false\n}\n\nexport default isChildRoute\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport pathToRegexp from 'path-to-regexp'\nimport matchRoute from './matchRoute'\nimport resolveRoute from './resolveRoute'\nimport isChildRoute from './isChildRoute'\n\nclass UniversalRouter {\n  constructor(routes, options = {}) {\n    if (!routes || typeof routes !== 'object') {\n      throw new TypeError('Invalid routes')\n    }\n\n    this.baseUrl = options.baseUrl || ''\n    this.errorHandler = options.errorHandler\n    this.resolveRoute = options.resolveRoute || resolveRoute\n    this.context = { router: this, ...options.context }\n    this.root = Array.isArray(routes) ? { path: '', children: routes, parent: null } : routes\n    this.root.parent = null\n  }\n\n  resolve(pathnameOrContext) {\n    const context = {\n      ...this.context,\n      ...(typeof pathnameOrContext === 'string'\n        ? { pathname: pathnameOrContext }\n        : pathnameOrContext),\n    }\n    const match = matchRoute(\n      this.root,\n      this.baseUrl,\n      context.pathname.substr(this.baseUrl.length),\n      [],\n      null,\n    )\n    const resolve = this.resolveRoute\n    let matches = null\n    let nextMatches = null\n    let currentContext = context\n\n    function next(resume, parent = matches.value.route, prevResult) {\n      const routeToSkip = prevResult === null && !matches.done && matches.value.route\n      matches = nextMatches || match.next(routeToSkip)\n      nextMatches = null\n\n      if (!resume) {\n        if (matches.done || !isChildRoute(parent, matches.value.route)) {\n          nextMatches = matches\n          return Promise.resolve(null)\n        }\n      }\n\n      if (matches.done) {\n        const error = new Error('Route not found')\n        error.status = 404\n        return Promise.reject(error)\n      }\n\n      currentContext = { ...context, ...matches.value }\n\n      return Promise.resolve(resolve(currentContext, matches.value.params)).then((result) => {\n        if (result !== null && result !== undefined) {\n          return result\n        }\n        return next(resume, parent, result)\n      })\n    }\n\n    context.next = next\n\n    return Promise.resolve()\n      .then(() => next(true, this.root))\n      .catch((error) => {\n        if (this.errorHandler) {\n          return this.errorHandler(error, currentContext)\n        }\n        throw error\n      })\n  }\n}\n\nUniversalRouter.pathToRegexp = pathToRegexp\n\nexport default UniversalRouter\n"],"names":["hasOwnProperty","Object","prototype","cache","Map","decodeParam","val","decodeURIComponent","err","matchPath","route","pathname","parentKeys","parentParams","end","children","cacheKey","path","regexp","get","keys","pattern","pathToRegexp","set","m","exec","params","i","length","key","prop","name","value","undefined","call","repeat","split","delimiter","map","charAt","substr","concat","matchRoute","baseUrl","match","childMatches","childIndex","next","routeToSkip","done","childRoute","parent","childMatch","resolveRoute","context","action","isChildRoute","parentRoute","UniversalRouter","routes","options","TypeError","errorHandler","router","root","Array","isArray","resolve","pathnameOrContext","matches","nextMatches","currentContext","resume","prevResult","Promise","error","Error","status","reject","then","result"],"mappings":"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"}